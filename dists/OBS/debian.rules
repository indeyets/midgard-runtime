#! /usr/bin/make -f

#export DH_VERBOSE=1
export DH_COMPAT=4
export DH_OPTIONS

DEB_BUILD_ARCH   ?= $(shell dpkg-architecture -qDEB_BUILD_ARCH)

build: build-stamp
build-stamp: configure-stamp
	dh_testdir
	#$(MAKE)
	touch $@

configure: configure-stamp
configure-stamp:
	dh_testdir
	touch $@

clean:
	rm -rf build.stamp configure-stamp
	rm -rf debian/tmp	
	rm -rf debian/midgard
	rm -rf debian/midgard-data

install: DH_OPTIONS=
install: build
	dh_testdir
	dh_testroot
	dh_installdirs
	cp -r build-stamp debian/midgard2-mvc-core/usr/share/midgardmvc_core/ 
	cp -r config debian/midgard2-mvc-core/usr/share/midgardmvc_core/  
	cp exceptionhandler.php debian/midgard2-mvc-core/usr/share/midgardmvc_core/ 
	cp -r helpers  debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp interface.php  debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp manifest.yml  debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r services  debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r templates debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r component  debian/midgard2-mvc-core/usr/share/midgardmvc_core/  
	cp -r configuration  debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r controllers      debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r documentation  debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp framework.php         debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r httpd    debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r locale         debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r python        debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r static    debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp -r tests debian/midgard2-mvc-core/usr/share/midgardmvc_core/
	cp ../pake*.tgz debian/midgard2-mvc-installer/usr/share/
	cp ../Appserver*.tgz debian/midgard2-mvc-installer/usr/share/

binary-indep: 
	DH_OPTIONS=-i

binary-indep: DH_OPTIONS=-a
binary-arch: install
	dh_testdir
	dh_testroot
	dh_installchangelogs
	dh_installdocs
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary:	binary-indep binary-arch
.PHONY: binary binary-arch binary-indep install configure build clean
